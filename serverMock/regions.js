/** Converts numeric degrees to radians */
if (typeof (Number.prototype.toRad) === "undefined") {
    Number.prototype.toRad = function () {
        return this * Math.PI / 180;
    }
}
const fs = require('fs');
const request = require("request");
const dataUrl = 'http://armstrongfluidtechnology.com/Data/ServiceableRegions';

const locations = [{ "id": 0, "latitude": "-14.3059409", "longitude": "-170.6962001", "region_name": "American Samoa", "subregion_name": "" }, { "id": 2, "latitude": "-20.9175738", "longitude": "142.7027956", "region_name": "Australia", "subregion_name": "Queensland" }, { "id": 5, "latitude": "-21.236736", "longitude": "-159.777671", "region_name": "Cook Islands", "subregion_name": "" }, { "id": 6, "latitude": "-17.713371", "longitude": "178.065032", "region_name": "Fiji", "subregion_name": "" }, { "id": 7, "latitude": "-17.679742", "longitude": "-149.406843", "region_name": "French Polynesia", "subregion_name": "" }, { "id": 8, "latitude": "13.444304", "longitude": "144.793731", "region_name": "Guam", "subregion_name": "" }, { "id": 12, "latitude": "-6.4058172", "longitude": "106.0640179", "region_name": "Indonesia", "subregion_name": "Banten" }, { "id": 14, "latitude": "36.204824", "longitude": "138.252924", "region_name": "Japan", "subregion_name": "" }, { "id": 15, "latitude": "1.871115", "longitude": "-157.3606692", "region_name": "Kiribati", "subregion_name": "" }, { "id": 16, "latitude": "19.85627", "longitude": "102.495496", "region_name": "Laos", "subregion_name": "" }, { "id": 17, "latitude": "22.201874", "longitude": "113.544202", "region_name": "Macau", "subregion_name": "" }, { "id": 19, "latitude": "3.509247", "longitude": "101.5248055", "region_name": "Malaysia", "subregion_name": "Selangor" }, { "id": 21, "latitude": "7.131474", "longitude": "171.184478", "region_name": "Marshall Islands", "subregion_name": "" }, { "id": 22, "latitude": "6.8874574", "longitude": "158.2150716", "region_name": "Micronesia", "subregion_name": "" }, { "id": 23, "latitude": "-0.522778", "longitude": "166.931503", "region_name": "Nauru", "subregion_name": "" }, { "id": 24, "latitude": "-20.904305", "longitude": "165.618042", "region_name": "New Caledonia", "subregion_name": "" }, { "id": 25, "latitude": "-40.900557", "longitude": "174.885971", "region_name": "New Zealand", "subregion_name": "" }, { "id": 26, "latitude": "-19.054445", "longitude": "-169.867233", "region_name": "Niue", "subregion_name": "" }, { "id": 30, "latitude": "7.51498", "longitude": "134.58252", "region_name": "Palau", "subregion_name": "" }, { "id": 31, "latitude": "-6.314993", "longitude": "143.95555", "region_name": "Papua New Guinea", "subregion_name": "" }, { "id": 32, "latitude": "12.879721", "longitude": "121.774017", "region_name": "Philippines", "subregion_name": "" }, { "id": 34, "latitude": "-13.759029", "longitude": "-172.104629", "region_name": "Samoa", "subregion_name": "" }, { "id": 35, "latitude": "1.352083", "longitude": "103.819836", "region_name": "Singapore", "subregion_name": "" }, { "id": 36, "latitude": "6.639449", "longitude": "100.205266", "region_name": "Singapore", "subregion_name": "Kaki Bukit" }, { "id": 37, "latitude": "-9.64571", "longitude": "160.156194", "region_name": "Solomon Islands", "subregion_name": "" }, { "id": 38, "latitude": "40.75121", "longitude": "-73.968923", "region_name": "South Korea", "subregion_name": "" }, { "id": 39, "latitude": "", "longitude": "", "region_name": "Taiwan", "subregion_name": "" }, { "id": 42, "latitude": "13.6762328", "longitude": "100.6928804", "region_name": "Thailand", "subregion_name": "Dok-Mai" }, { "id": 43, "latitude": "", "longitude": "", "region_name": "Timor-Leste", "subregion_name": "" }, { "id": 45, "latitude": "-9.2002", "longitude": "-171.8484", "region_name": "Tokelau", "subregion_name": "" }, { "id": 46, "latitude": "-21.178986", "longitude": "-175.198242", "region_name": "Tonga", "subregion_name": "" }, { "id": 47, "latitude": "-7.4784419", "longitude": "178.6799214", "region_name": "Tuvalu", "subregion_name": "" }, { "id": 48, "latitude": "-15.376706", "longitude": "166.959158", "region_name": "Vanuatu", "subregion_name": "" }, { "id": 49, "latitude": "21.0250587", "longitude": "105.8434327", "region_name": "Vietnam", "subregion_name": "" }, { "id": 52, "latitude": "53.9332706", "longitude": "-116.5765035", "region_name": "Canada", "subregion_name": "Alberta" }, { "id": 53, "latitude": "53.7266683", "longitude": "-127.6476206", "region_name": "Canada", "subregion_name": "British Columbia" }, { "id": 54, "latitude": "53.7608608", "longitude": "-98.8138763", "region_name": "Canada", "subregion_name": "Manitoba" }, { "id": 55, "latitude": "46.5653163", "longitude": "-66.4619164", "region_name": "Canada", "subregion_name": "New Brunswick" }, { "id": 56, "latitude": "53.1355091", "longitude": "-57.6604364", "region_name": "Canada", "subregion_name": "Newfoundland and Labrador" }, { "id": 57, "latitude": "64.8255441", "longitude": "-124.8457334", "region_name": "Canada", "subregion_name": "Northwest Territories" }, { "id": 58, "latitude": "44.6819866", "longitude": "-63.744311", "region_name": "Canada", "subregion_name": "Nova Scotia" }, { "id": 60, "latitude": "51.253775", "longitude": "-85.3232139", "region_name": "Canada", "subregion_name": "Ontario" }, { "id": 61, "latitude": "46.510712", "longitude": "-63.4168136", "region_name": "Canada", "subregion_name": "Prince Edward Island" }, { "id": 62, "latitude": "52.9399159", "longitude": "-73.5491361", "region_name": "Canada", "subregion_name": "Quebec" }, { "id": 63, "latitude": "52.9399159", "longitude": "-106.4508639", "region_name": "Canada", "subregion_name": "Saskatchewan" }, { "id": 65, "latitude": "35.86166", "longitude": "104.195397", "region_name": "China", "subregion_name": "" }, { "id": 103, "latitude": "17.0477624", "longitude": "80.0981869", "region_name": "India", "subregion_name": "Andrapradesh" }, { "id": 107, "latitude": "", "longitude": "", "region_name": "India", "subregion_name": "Chandigarh" }, { "id": 109, "latitude": "28.635308", "longitude": "77.22496", "region_name": "India", "subregion_name": "Delhi" }, { "id": 111, "latitude": "22.258652", "longitude": "71.1923805", "region_name": "India", "subregion_name": "Gujarat" }, { "id": 116, "latitude": "15.3172775", "longitude": "75.7138884", "region_name": "India", "subregion_name": "Karnataka" }, { "id": 117, "latitude": "10.8505159", "longitude": "76.2710833", "region_name": "India", "subregion_name": "Kerala" }, { "id": 118, "latitude": "", "longitude": "", "region_name": "India", "subregion_name": "Madhya Pradesh" }, { "id": 119, "latitude": "19.7514798", "longitude": "75.7138884", "region_name": "India", "subregion_name": "Maharashtra" }, { "id": 128, "latitude": "11.1271225", "longitude": "78.6568942", "region_name": "India", "subregion_name": "Tamil Nadu" }, { "id": 129, "latitude": "", "longitude": "", "region_name": "India", "subregion_name": "Telangana" }, { "id": 133, "latitude": "22.9867569", "longitude": "87.8549755", "region_name": "India", "subregion_name": "West Bengal" }, { "id": 134, "latitude": "33.93911", "longitude": "67.709953", "region_name": "Afghanistan", "subregion_name": "" }, { "id": 135, "latitude": "28.033886", "longitude": "1.659626", "region_name": "Algeria", "subregion_name": "" }, { "id": 136, "latitude": "40.069099", "longitude": "45.038189", "region_name": "Armenia", "subregion_name": "" }, { "id": 137, "latitude": "40.143105", "longitude": "47.576927", "region_name": "Azerbaijan", "subregion_name": "" }, { "id": 138, "latitude": "26.0667", "longitude": "50.5577", "region_name": "Bahrain", "subregion_name": "" }, { "id": 139, "latitude": "23.709921", "longitude": "90.407143", "region_name": "Bangladesh", "subregion_name": "" }, { "id": 140, "latitude": "23.709921", "longitude": "90.407143", "region_name": "Bangladesh", "subregion_name": "Dhakr" }, { "id": 141, "latitude": "27.514162", "longitude": "90.433601", "region_name": "Bhutan", "subregion_name": "" }, { "id": 142, "latitude": "4.535277", "longitude": "114.727669", "region_name": "Brunei", "subregion_name": "" }, { "id": 144, "latitude": "7.539989", "longitude": "-5.54708", "region_name": "Ivory Coast", "subregion_name": "" }, { "id": 145, "latitude": "12.565679", "longitude": "104.990963", "region_name": "Cambodia", "subregion_name": "" }, { "id": 150, "latitude": "33.223191", "longitude": "43.679291", "region_name": "Iraq", "subregion_name": "" }, { "id": 151, "latitude": "31.046051", "longitude": "34.851612", "region_name": "Israel", "subregion_name": "" }, { "id": 152, "latitude": "30.585164", "longitude": "36.238414", "region_name": "Jordan", "subregion_name": "" }, { "id": 153, "latitude": "48.019573", "longitude": "66.923684", "region_name": "Kazakhstan", "subregion_name": "" }, { "id": 154, "latitude": "29.31166", "longitude": "47.481766", "region_name": "Kuwait", "subregion_name": "" }, { "id": 155, "latitude": "41.20438", "longitude": "74.766098", "region_name": "Kyrgyzstan", "subregion_name": "" }, { "id": 157, "latitude": "33.8848675", "longitude": "35.5178952", "region_name": "Lebanon", "subregion_name": "Achrafieh" }, { "id": 158, "latitude": "1.9772469", "longitude": "73.5361035", "region_name": "Maldives", "subregion_name": "" }, { "id": 159, "latitude": "46.862496", "longitude": "103.846656", "region_name": "Mongolia", "subregion_name": "" }, { "id": 161, "latitude": "28.394857", "longitude": "84.124008", "region_name": "Nepal", "subregion_name": "" }, { "id": 163, "latitude": "23.61", "longitude": "58.54", "region_name": "Oman", "subregion_name": "Muscat" }, { "id": 164, "latitude": "30.375321", "longitude": "69.345116", "region_name": "Pakistan", "subregion_name": "" }, { "id": 165, "latitude": "25.354826", "longitude": "51.183884", "region_name": "Qatar", "subregion_name": "" }, { "id": 167, "latitude": "-0.228021", "longitude": "15.827659", "region_name": "Republic of the Congo", "subregion_name": "" }, { "id": 168, "latitude": "23.885942", "longitude": "45.079162", "region_name": "Saudi Arabia", "subregion_name": "" }, { "id": 169, "latitude": "7.873054", "longitude": "80.771797", "region_name": "Sri Lanka", "subregion_name": "" }, { "id": 171, "latitude": "38.861034", "longitude": "71.276093", "region_name": "Tajikistan", "subregion_name": "" }, { "id": 172, "latitude": "8.619543", "longitude": "0.824782", "region_name": "Togo", "subregion_name": "" }, { "id": 173, "latitude": "33.886917", "longitude": "9.537499", "region_name": "Tunisia", "subregion_name": "" }, { "id": 174, "latitude": "38.969719", "longitude": "59.556278", "region_name": "Turkmenistan", "subregion_name": "" }, { "id": 175, "latitude": "1.373333", "longitude": "32.290275", "region_name": "Uganda", "subregion_name": "" }, { "id": 176, "latitude": "23.424076", "longitude": "53.847818", "region_name": "United Arab Emirates", "subregion_name": "" }, { "id": 178, "latitude": "41.377491", "longitude": "64.585262", "region_name": "Uzbekistan", "subregion_name": "" }, { "id": 180, "latitude": "24.215527", "longitude": "-12.885834", "region_name": "Western Sahara", "subregion_name": "" }, { "id": 181, "latitude": "15.552727", "longitude": "48.516388", "region_name": "Yemen", "subregion_name": "" }, { "id": 182, "latitude": "15.552727", "longitude": "48.516388", "region_name": "Yemen", "subregion_name": "Republic of Yemen" }, { "id": 183, "latitude": "-13.133897", "longitude": "27.849332", "region_name": "Zambia", "subregion_name": "" }, { "id": 185, "latitude": "-11.202692", "longitude": "17.873887", "region_name": "Angola", "subregion_name": "" }, { "id": 186, "latitude": "9.30769", "longitude": "2.315834", "region_name": "Benin", "subregion_name": "" }, { "id": 187, "latitude": "-22.328474", "longitude": "24.684866", "region_name": "Botswana", "subregion_name": "" }, { "id": 188, "latitude": "12.238333", "longitude": "-1.561593", "region_name": "Burkina Faso", "subregion_name": "" }, { "id": 189, "latitude": "-3.373056", "longitude": "29.918886", "region_name": "Burundi", "subregion_name": "" }, { "id": 190, "latitude": "7.369722", "longitude": "12.354722", "region_name": "Cameroon", "subregion_name": "" }, { "id": 191, "latitude": "15.119368", "longitude": "-23.6354246", "region_name": "Cape Verde", "subregion_name": "" }, { "id": 192, "latitude": "6.611111", "longitude": "20.939444", "region_name": "Central African Republic", "subregion_name": "" }, { "id": 193, "latitude": "15.454166", "longitude": "18.732207", "region_name": "Chad", "subregion_name": "" }, { "id": 194, "latitude": "-11.6455", "longitude": "43.3333", "region_name": "Comoros", "subregion_name": "" }, { "id": 196, "latitude": "11.825138", "longitude": "42.590275", "region_name": "Djibouti", "subregion_name": "" }, { "id": 197, "latitude": "26.820553", "longitude": "30.802498", "region_name": "Egypt", "subregion_name": "" }, { "id": 198, "latitude": "1.650801", "longitude": "10.267895", "region_name": "Equatorial Guinea", "subregion_name": "" }, { "id": 200, "latitude": "9.145", "longitude": "40.489673", "region_name": "Ethiopia", "subregion_name": "" }, { "id": 201, "latitude": "-0.803689", "longitude": "11.609444", "region_name": "Gabon", "subregion_name": "" }, { "id": 202, "latitude": "13.443182", "longitude": "-15.310139", "region_name": "Gambia", "subregion_name": "" }, { "id": 204, "latitude": "5.5557169", "longitude": "-0.196306", "region_name": "Ghana", "subregion_name": "Accra" }, { "id": 205, "latitude": "9.945587", "longitude": "-9.696645", "region_name": "Guinea", "subregion_name": "" }, { "id": 208, "latitude": "-0.023559", "longitude": "37.906193", "region_name": "Kenya", "subregion_name": "" }, { "id": 209, "latitude": "-29.609988", "longitude": "28.233608", "region_name": "Lesotho", "subregion_name": "" }, { "id": 211, "latitude": "26.3351", "longitude": "17.228331", "region_name": "Libya", "subregion_name": "" }, { "id": 212, "latitude": "-18.766947", "longitude": "46.869107", "region_name": "Madagascar", "subregion_name": "" }, { "id": 213, "latitude": "-13.254308", "longitude": "34.301525", "region_name": "Malawi", "subregion_name": "" }, { "id": 214, "latitude": "17.570692", "longitude": "-3.996166", "region_name": "Mali", "subregion_name": "" }, { "id": 215, "latitude": "21.00789", "longitude": "-10.940835", "region_name": "Mauritania", "subregion_name": "" }, { "id": 216, "latitude": "-20.348404", "longitude": "57.552152", "region_name": "Mauritius", "subregion_name": "" }, { "id": 220, "latitude": "-18.665695", "longitude": "35.529562", "region_name": "Mozambique", "subregion_name": "" }, { "id": 221, "latitude": "-22.95764", "longitude": "18.49041", "region_name": "Namibia", "subregion_name": "" }, { "id": 222, "latitude": "17.607789", "longitude": "8.081666", "region_name": "Niger", "subregion_name": "" }, { "id": 224, "latitude": "6.441158", "longitude": "3.417977", "region_name": "Nigeria", "subregion_name": "Lagos" }, { "id": 226, "latitude": "", "longitude": "", "region_name": "Reunion", "subregion_name": "" }, { "id": 227, "latitude": "-1.940278", "longitude": "29.873888", "region_name": "Rwanda", "subregion_name": "" }, { "id": 230, "latitude": "14.497401", "longitude": "-14.452362", "region_name": "Senegal", "subregion_name": "" }, { "id": 231, "latitude": "-4.679574", "longitude": "55.491977", "region_name": "Seychelles", "subregion_name": "" }, { "id": 234, "latitude": "-28.4792625", "longitude": "24.6727135", "region_name": "South Africa", "subregion_name": "" }, { "id": 236, "latitude": "-26.522503", "longitude": "31.465866", "region_name": "Swaziland", "subregion_name": "" }, { "id": 237, "latitude": "-6.369028", "longitude": "34.888822", "region_name": "Tanzania", "subregion_name": "" }, { "id": 238, "latitude": "41.153332", "longitude": "20.168331", "region_name": "Albania", "subregion_name": "" }, { "id": 239, "latitude": "42.506285", "longitude": "1.521801", "region_name": "Andorra", "subregion_name": "" }, { "id": 241, "latitude": "47.516231", "longitude": "14.550072", "region_name": "Austria", "subregion_name": "" }, { "id": 243, "latitude": "50.503887", "longitude": "4.469936", "region_name": "Belgium", "subregion_name": "" }, { "id": 244, "latitude": "43.915886", "longitude": "17.679076", "region_name": "Bosnia and Herzegovina", "subregion_name": "" }, { "id": 245, "latitude": "42.733883", "longitude": "25.48583", "region_name": "Bulgaria", "subregion_name": "" }, { "id": 246, "latitude": "45.1", "longitude": "15.2", "region_name": "Croatia", "subregion_name": "" }, { "id": 247, "latitude": "35.126413", "longitude": "33.429859", "region_name": "Cyprus", "subregion_name": "" }, { "id": 248, "latitude": "49.817492", "longitude": "15.472962", "region_name": "Czech Republic", "subregion_name": "" }, { "id": 249, "latitude": "56.26392", "longitude": "9.501785", "region_name": "Denmark", "subregion_name": "" }, { "id": 250, "latitude": "58.595272", "longitude": "25.013607", "region_name": "Estonia", "subregion_name": "" }, { "id": 252, "latitude": "61.92411", "longitude": "25.748151", "region_name": "Finland", "subregion_name": "" }, { "id": 253, "latitude": "47.1387675", "longitude": "2.993518", "region_name": "France", "subregion_name": "" }, { "id": 256, "latitude": "51.165691", "longitude": "10.451526", "region_name": "Germany", "subregion_name": "" }, { "id": 257, "latitude": "36.140751", "longitude": "-5.353585", "region_name": "Gibraltar", "subregion_name": "" }, { "id": 258, "latitude": "39.074208", "longitude": "21.824312", "region_name": "Greece", "subregion_name": "" }, { "id": 259, "latitude": "9.0804837", "longitude": "7.4968513", "region_name": "Holy See (Vatican City)", "subregion_name": "" }, { "id": 260, "latitude": "47.162494", "longitude": "19.503304", "region_name": "Hungary", "subregion_name": "" }, { "id": 262, "latitude": "64.135338", "longitude": "-21.89521", "region_name": "Iceland", "subregion_name": "Reykjavik" }, { "id": 263, "latitude": "53.41291", "longitude": "-8.24389", "region_name": "Ireland", "subregion_name": "" }, { "id": 264, "latitude": "53.2817307", "longitude": "-6.466167", "region_name": "Ireland", "subregion_name": "Rathcoole" }, { "id": 265, "latitude": "41.87194", "longitude": "12.56738", "region_name": "Italy", "subregion_name": "" }, { "id": 268, "latitude": "56.879635", "longitude": "24.603189", "region_name": "Latvia", "subregion_name": "" }, { "id": 269, "latitude": "47.166", "longitude": "9.555373", "region_name": "Liechtenstein", "subregion_name": "" }, { "id": 270, "latitude": "55.169438", "longitude": "23.881275", "region_name": "Lithuania", "subregion_name": "" }, { "id": 271, "latitude": "49.815273", "longitude": "6.129583", "region_name": "Luxembourg", "subregion_name": "" }, { "id": 272, "latitude": "41.608635", "longitude": "21.745275", "region_name": "Macedonia", "subregion_name": "" }, { "id": 273, "latitude": "35.937496", "longitude": "14.375416", "region_name": "Malta", "subregion_name": "" }, { "id": 274, "latitude": "47.0272465", "longitude": "28.8265479", "region_name": "Moldova", "subregion_name": "" }, { "id": 275, "latitude": "43.7384176", "longitude": "7.4246158", "region_name": "Monaco", "subregion_name": "" }, { "id": 276, "latitude": "42.708678", "longitude": "19.37439", "region_name": "Montenegro", "subregion_name": "" }, { "id": 277, "latitude": "52.132633", "longitude": "5.291266", "region_name": "Netherlands", "subregion_name": "" }, { "id": 278, "latitude": "60.472024", "longitude": "8.468946", "region_name": "Norway", "subregion_name": "" }, { "id": 279, "latitude": "51.919438", "longitude": "19.145136", "region_name": "Poland", "subregion_name": "" }, { "id": 280, "latitude": "39.399872", "longitude": "-8.224454", "region_name": "Portugal", "subregion_name": "" }, { "id": 281, "latitude": "45.943161", "longitude": "24.96676", "region_name": "Romania", "subregion_name": "" }, { "id": 282, "latitude": "55.751603", "longitude": "37.618719", "region_name": "Russia", "subregion_name": "" }, { "id": 283, "latitude": "43.94236", "longitude": "12.457777", "region_name": "San Marino", "subregion_name": "" }, { "id": 284, "latitude": "44.016521", "longitude": "21.005859", "region_name": "Serbia", "subregion_name": "" }, { "id": 285, "latitude": "48.669026", "longitude": "19.699024", "region_name": "Slovakia", "subregion_name": "" }, { "id": 286, "latitude": "46.151241", "longitude": "14.995463", "region_name": "Slovenia", "subregion_name": "" }, { "id": 288, "latitude": "40.4167754", "longitude": "-3.7037902", "region_name": "Spain", "subregion_name": "Madrid" }, { "id": 289, "latitude": "60.128161", "longitude": "18.643501", "region_name": "Sweden", "subregion_name": "" }, { "id": 290, "latitude": "46.818188", "longitude": "8.227512", "region_name": "Switzerland", "subregion_name": "" }, { "id": 294, "latitude": "48.379433", "longitude": "31.16558", "region_name": "Ukraine", "subregion_name": "" }, { "id": 295, "latitude": "55.378051", "longitude": "-3.435973", "region_name": "United Kingdom", "subregion_name": "" }, { "id": 298, "latitude": "18.220554", "longitude": "-63.068615", "region_name": "Anguilla", "subregion_name": "" }, { "id": 299, "latitude": "17.060816", "longitude": "-61.796428", "region_name": "Antigua and Barbuda", "subregion_name": "" }, { "id": 300, "latitude": "-38.416097", "longitude": "-63.616672", "region_name": "Argentina", "subregion_name": "" }, { "id": 302, "latitude": "12.52111", "longitude": "-69.968338", "region_name": "Aruba", "subregion_name": "" }, { "id": 303, "latitude": "25.03428", "longitude": "-77.39628", "region_name": "Bahamas", "subregion_name": "" }, { "id": 304, "latitude": "13.193887", "longitude": "-59.543198", "region_name": "Barbados", "subregion_name": "" }, { "id": 305, "latitude": "17.189877", "longitude": "-88.49765", "region_name": "Belize", "subregion_name": "" }, { "id": 306, "latitude": "32.3078", "longitude": "-64.7505", "region_name": "Bermuda", "subregion_name": "" }, { "id": 307, "latitude": "-17", "longitude": "-65", "region_name": "Bolivia", "subregion_name": "" }, { "id": 309, "latitude": "-22.9139476", "longitude": "-43.2093973", "region_name": "Brazil", "subregion_name": "RJ" }, { "id": 311, "latitude": "19.3133", "longitude": "-81.2546", "region_name": "Cayman Islands", "subregion_name": "" }, { "id": 313, "latitude": "-33.4691199", "longitude": "-70.641997", "region_name": "Chile", "subregion_name": "Santiago" }, { "id": 314, "latitude": "4.570868", "longitude": "-74.297333", "region_name": "Colombia", "subregion_name": "" }, { "id": 316, "latitude": "9.748917", "longitude": "-83.753428", "region_name": "Costa Rica", "subregion_name": "Costa Rica" }, { "id": 317, "latitude": "21.521757", "longitude": "-77.781167", "region_name": "Cuba", "subregion_name": "" }, { "id": 318, "latitude": "15.414999", "longitude": "-61.370976", "region_name": "Dominica", "subregion_name": "" }, { "id": 319, "latitude": "18.735693", "longitude": "-70.162651", "region_name": "Dominican Republic", "subregion_name": "" }, { "id": 320, "latitude": "-1.831239", "longitude": "-78.183406", "region_name": "Ecuador", "subregion_name": "" }, { "id": 323, "latitude": "3.933889", "longitude": "-53.125782", "region_name": "French Guiana", "subregion_name": "" }, { "id": 324, "latitude": "12.1165", "longitude": "-61.679", "region_name": "Grenada", "subregion_name": "" }, { "id": 325, "latitude": "16.265", "longitude": "-61.551", "region_name": "Guadeloupe", "subregion_name": "" }, { "id": 326, "latitude": "15.783471", "longitude": "-90.230759", "region_name": "Guatemala", "subregion_name": "" }, { "id": 327, "latitude": "4.860416", "longitude": "-58.93018", "region_name": "Guyana", "subregion_name": "" }, { "id": 328, "latitude": "18.971187", "longitude": "-72.285215", "region_name": "Haiti", "subregion_name": "" }, { "id": 330, "latitude": "18.109581", "longitude": "-77.297508", "region_name": "Jamaica", "subregion_name": "" }, { "id": 331, "latitude": "14.641528", "longitude": "-61.024174", "region_name": "Martinique", "subregion_name": "" }, { "id": 333, "latitude": "30.8406338", "longitude": "-115.2837585", "region_name": "Mexico", "subregion_name": "Baja California" }, { "id": 334, "latitude": "20.1540195", "longitude": "-103.914399", "region_name": "Mexico", "subregion_name": "Jalisco" }, { "id": 335, "latitude": "19.4326077", "longitude": "-99.133208", "region_name": "Mexico", "subregion_name": "Mexico DF" }, { "id": 336, "latitude": "25.592172", "longitude": "-99.9961947", "region_name": "Mexico", "subregion_name": "Nuevo León" }, { "id": 337, "latitude": "19.7453532", "longitude": "-88.0034835", "region_name": "Mexico", "subregion_name": "Quintana Roo" }, { "id": 338, "latitude": "20.6262543", "longitude": "-89.2337423", "region_name": "Mexico", "subregion_name": "Yucatán" }, { "id": 339, "latitude": "16.742498", "longitude": "-62.187366", "region_name": "Montserrat", "subregion_name": "" }, { "id": 340, "latitude": "12.865416", "longitude": "-85.207229", "region_name": "Nicaragua", "subregion_name": "" }, { "id": 341, "latitude": "8.537981", "longitude": "-80.782127", "region_name": "Panama", "subregion_name": "" }, { "id": 342, "latitude": "-23.442503", "longitude": "-58.443832", "region_name": "Paraguay", "subregion_name": "" }, { "id": 344, "latitude": "-12.0478158", "longitude": "-77.0622028", "region_name": "Peru", "subregion_name": "Lima" }, { "id": 346, "latitude": "18.220833", "longitude": "-66.590149", "region_name": "Puerto Rico", "subregion_name": "" }, { "id": 347, "latitude": "17.9", "longitude": "-62.833333", "region_name": "Saint Barthelemy", "subregion_name": "" }, { "id": 348, "latitude": "13.909444", "longitude": "-60.978893", "region_name": "Saint Lucia", "subregion_name": "" }, { "id": 349, "latitude": "18.0782902", "longitude": "-63.0542197", "region_name": "Saint Martin", "subregion_name": "" }, { "id": 351, "latitude": "13.253351", "longitude": "-61.1962509", "region_name": "Saint Vincent and the Grenadines", "subregion_name": "" }, { "id": 352, "latitude": "3.919305", "longitude": "-56.027783", "region_name": "Suriname", "subregion_name": "" }, { "id": 353, "latitude": "10.691803", "longitude": "-61.222503", "region_name": "Trinidad and Tobago", "subregion_name": "" }, { "id": 354, "latitude": "21.694025", "longitude": "-71.797928", "region_name": "Turks and Caicos Islands", "subregion_name": "" }, { "id": 355, "latitude": "18.335765", "longitude": "-64.896335", "region_name": "U.S. Virgin Islands", "subregion_name": "" }, { "id": 357, "latitude": "32.3182314", "longitude": "-86.902298", "region_name": "USA", "subregion_name": "Alabama" }, { "id": 358, "latitude": "64.2008413", "longitude": "-149.4936733", "region_name": "USA", "subregion_name": "Alaska" }, { "id": 359, "latitude": "34.0489281", "longitude": "-111.0937311", "region_name": "USA", "subregion_name": "Arizona" }, { "id": 360, "latitude": "35.20105", "longitude": "-91.8318334", "region_name": "USA", "subregion_name": "Arkansas" }, { "id": 361, "latitude": "36.778261", "longitude": "-119.4179324", "region_name": "USA", "subregion_name": "California" }, { "id": 362, "latitude": "39.5500507", "longitude": "-105.7820674", "region_name": "USA", "subregion_name": "Colorado" }, { "id": 364, "latitude": "41.6032207", "longitude": "-73.087749", "region_name": "USA", "subregion_name": "Connecticut" }, { "id": 365, "latitude": "38.9108325", "longitude": "-75.5276699", "region_name": "USA", "subregion_name": "Delaware" }, { "id": 366, "latitude": "27.6648274", "longitude": "-81.5157535", "region_name": "USA", "subregion_name": "Florida" }, { "id": 367, "latitude": "32.1574351", "longitude": "-82.907123", "region_name": "USA", "subregion_name": "Georgia" }, { "id": 368, "latitude": "19.8967662", "longitude": "-155.5827818", "region_name": "USA", "subregion_name": "Hawaii" }, { "id": 369, "latitude": "44.0682019", "longitude": "-114.7420408", "region_name": "USA", "subregion_name": "Idaho" }, { "id": 370, "latitude": "40.6331249", "longitude": "-89.3985283", "region_name": "USA", "subregion_name": "Illinois" }, { "id": 371, "latitude": "40.2671941", "longitude": "-86.1349019", "region_name": "USA", "subregion_name": "Indiana" }, { "id": 373, "latitude": "41.8780025", "longitude": "-93.097702", "region_name": "USA", "subregion_name": "Iowa" }, { "id": 374, "latitude": "39.011902", "longitude": "-98.4842465", "region_name": "USA", "subregion_name": "Kansas" }, { "id": 375, "latitude": "37.8393332", "longitude": "-84.2700179", "region_name": "USA", "subregion_name": "Kentucky" }, { "id": 376, "latitude": "31.2448234", "longitude": "-92.1450245", "region_name": "USA", "subregion_name": "Louisiana" }, { "id": 377, "latitude": "﻿44.31056", "longitude": "69.78000", "region_name": "USA", "subregion_name": "Maine" }, { "id": 378, "latitude": "39.0457549", "longitude": "-76.6412712", "region_name": "USA", "subregion_name": "Maryland" }, { "id": 379, "latitude": "42.4072107", "longitude": "-71.3824374", "region_name": "USA", "subregion_name": "Massachusetts" }, { "id": 380, "latitude": "44.3148443", "longitude": "-85.6023643", "region_name": "USA", "subregion_name": "Michigan" }, { "id": 381, "latitude": "46.729553", "longitude": "-94.6858998", "region_name": "USA", "subregion_name": "Minnesota" }, { "id": 383, "latitude": "37.9642529", "longitude": "-91.8318334", "region_name": "USA", "subregion_name": "Missouri" }, { "id": 384, "latitude": "46.8796822", "longitude": "-110.3625658", "region_name": "USA", "subregion_name": "Montana" }, { "id": 385, "latitude": "41.4925374", "longitude": "-99.9018131", "region_name": "USA", "subregion_name": "Nebraska" }, { "id": 386, "latitude": "38.8026097", "longitude": "-116.419389", "region_name": "USA", "subregion_name": "Nevada" }, { "id": 387, "latitude": "43.1938516", "longitude": "-71.5723953", "region_name": "USA", "subregion_name": "New Hampshire" }, { "id": 388, "latitude": "40.0583238", "longitude": "-74.4056612", "region_name": "USA", "subregion_name": "New Jersey" }, { "id": 389, "latitude": "34.5199402", "longitude": "-105.8700901", "region_name": "USA", "subregion_name": "New Mexico" }, { "id": 390, "latitude": "40.7143528", "longitude": "-74.0059731", "region_name": "USA", "subregion_name": "New York" }, { "id": 391, "latitude": "35.7595731", "longitude": "-79.0192997", "region_name": "USA", "subregion_name": "North Carolina" }, { "id": 392, "latitude": "47.5514926", "longitude": "-101.0020119", "region_name": "USA", "subregion_name": "North Dakota" }, { "id": 393, "latitude": "40.4172871", "longitude": "-82.907123", "region_name": "USA", "subregion_name": "Ohio" }, { "id": 394, "latitude": "35.4675602", "longitude": "-97.5164276", "region_name": "USA", "subregion_name": "Oklahoma" }, { "id": 395, "latitude": "43.8041334", "longitude": "-120.5542012", "region_name": "USA", "subregion_name": "Oregon" }, { "id": 396, "latitude": "41.2033216", "longitude": "-77.1945247", "region_name": "USA", "subregion_name": "Pennsylvania" }, { "id": 397, "latitude": "26.1280717", "longitude": "-98.0072568", "region_name": "USA", "subregion_name": "Puerto Rico" }, { "id": 398, "latitude": "41.5800945", "longitude": "-71.4774291", "region_name": "USA", "subregion_name": "Rhode Island" }, { "id": 399, "latitude": "33.836081", "longitude": "-81.1637245", "region_name": "USA", "subregion_name": "South Carolina" }, { "id": 400, "latitude": "43.9695148", "longitude": "-99.9018131", "region_name": "USA", "subregion_name": "South Dakota" }, { "id": 401, "latitude": "35.5174913", "longitude": "-86.5804473", "region_name": "USA", "subregion_name": "Tennessee" }, { "id": 402, "latitude": "31.9685988", "longitude": "-99.9018131", "region_name": "USA", "subregion_name": "Texas" }, { "id": 403, "latitude": "39.3209801", "longitude": "-111.0937311", "region_name": "USA", "subregion_name": "Utah" }, { "id": 404, "latitude": "44.5588028", "longitude": "-72.5778415", "region_name": "USA", "subregion_name": "Vermont" }, { "id": 405, "latitude": "37.4315734", "longitude": "-78.6568942", "region_name": "USA", "subregion_name": "Virginia" }, { "id": 406, "latitude": "38.9072309", "longitude": "-77.0364641", "region_name": "USA", "subregion_name": "Washington" }, { "id": 407, "latitude": "38.8935965", "longitude": "-77.014576", "region_name": "USA", "subregion_name": "District of Columbia" }, { "id": 409, "latitude": "43.7844397", "longitude": "-88.7878678", "region_name": "USA", "subregion_name": "Wisconsin" }, { "id": 412, "latitude": "-34.8836111", "longitude": "-56.1819444", "region_name": "Uruguay", "subregion_name": "Montevideo" }, { "id": 413, "latitude": "6.42375", "longitude": "-66.58973", "region_name": "Venezuela", "subregion_name": "" }]

function distance(position1, position2) {
    var lat1 = Number(position1.latitude);
    var lat2 = position2.latitude;
    var lon1 = Number(position1.longitude);
    var lon2 = position2.longitude;
    var R = 6371000; // metres
    var φ1 = lat1.toRad();
    var φ2 = lat2.toRad();
    var Δφ = (lat2 - lat1).toRad();
    var Δλ = (lon2 - lon1).toRad();

    var a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +
        Math.cos(φ1) * Math.cos(φ2) *
        Math.sin(Δλ / 2) * Math.sin(Δλ / 2);
    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

    var d = R * c;
    return d;
}
const getNearset = (coords) => {
    var closest = locations[0];
    var closest_distance = distance(closest, coords);
    for (var i = 1; i < locations.length; i++) {
        if (distance(locations[i], coords) < closest_distance) {
            closest_distance = distance(locations[i], coords);
            closest = locations[i];
        }
    }
    return closest;
}
const getNearsetByText = (text) => {
    let region = null;
    for (var i = 1; i < locations.length; i++) {
        const loc = locations[i];
        // region_name":  "subregion_name
        if (loc.region_name.toLowerCase().replace(/ /g, '') === text
            || loc.subregion_name.toLowerCase().replace(/ /g, '') === text
            || text === `${loc.subregion_name.toLowerCase()},${loc.region_name.toLowerCase()}`.replace(/ /g, '')) {
            region = loc;
            break;
        }
    }
    return region;
}
const getSubRegions = (text) => {
    let subRegions = [];
    for (var i = 1; i < locations.length; i++) {
        const loc = locations[i];
        // region_name":  "subregion_name
        if (loc.region_name.toLowerCase().replace(/ /g, '') === text) {
            subRegions.push(loc);
        }
    }
    return subRegions;
}
const getNearset2 = (coords) => {
    var mindif = 99999;
    var closest = null;

    for (index = 0; index < locations.length; ++index) {
        var dif = PythagorasEquirectangular(coords.latitude,
            coords.longitude, locations[index].latitude, locations[index].longitude);
        if (dif < mindif) {
            closest = index;
            mindif = dif;
        }
    }
    closest = closest ? closest : 0;
    return locations[closest];
}
function Deg2Rad(deg) {
    return deg * Math.PI / 180;
}

function PythagorasEquirectangular(lat1, lon1, lat2, lon2) {
    console.log(`${lat1}, ${lon1}, ${lat2}, ${lon2}`)
    lat1 = Deg2Rad(lat1);
    lat2 = Deg2Rad(lat2);
    lon1 = Deg2Rad(lon1);
    lon2 = Deg2Rad(lon2);
    var R = 6371; // km
    var x = (lon2 - lon1) * Math.cos((lat1 + lat2) / 2);
    var y = (lat2 - lat1);
    var d = Math.sqrt(x * x + y * y) * R;
    return d;
}
function getAllRegions() {
    let allRgions = {};
    for (var i = 1; i < locations.length; i++) {
        const loc = locations[i];
        // region_name":  "subregion_name
        if (!allRgions[loc.region_name]) {
            allRgions[loc.region_name] = true;
        }
    }
    return Object.keys(allRgions);
}
function getAllRegionsMock() {
    return ['USA',
        'United Kingdom',
        'Canada',
        'China',
        'India',
        'Germany',
        'France',
        'Afghanistan',
        'Bahrain',
        'Bangladesh',
        'Bhutan',
        'Brunei',
        'Iraq']
}
function getRegionSVC(regionId) {
    return new Promise((resolve, reject) => {
        fs.readFile('./serverMock/svc.json', (err, data) => {
            if (err) {
                reject();
                return;
            }
            let centers = JSON.parse(data);
            const allRep = [];
            centers.forEach((val) => {
                if (val.serviceable_region_ids.includes(regionId)) {
                    allRep.push(val);
                }
            });
            if (allRep.length > 0) {
                resolve(allRep);
            } else {
                reject();
            }
        });
    });
}

// TEST "55.378051", "longitude": "-3.435973"
// 51.507351/-0.127758
// console.log(getNearset({ latitude: 51.507351, longitude: -0.127758 }));
console.log(getAllRegions('india').length);
module.exports = { getNearset, getRegionSVC, getNearsetByText, getSubRegions, getAllRegionsMock }